{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Admin\\\\Documents\\\\GitHub\\\\Project\\\\Book-Social-Network\\\\frontend\\\\src\\\\components\\\\Chat\\\\Pages\\\\ChatContainer.jsx\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState, useRef } from \"react\";\nimport ChatInput from \"./ChatInput\";\nimport { io } from \"socket.io-client\";\nimport ChatService from \"../Service/service\";\nimport { v4 as uuidv4 } from 'uuid';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport default function ChatContainer(_ref) {\n  _s();\n\n  let {\n    currentChat,\n    currentUser,\n    socket\n  } = _ref;\n  const [messages, setMessages] = useState([]);\n  const [arrivalMessage, setArrivalMessage] = useState(null);\n  const scrollRef = useRef();\n  useEffect(() => {\n    if (currentUser) {\n      socket.current = io(\"http://localhost:4000\");\n      socket.current.emit(\"add-user\", currentUser._id);\n    }\n  }, [currentUser]);\n\n  const getValue = async () => {\n    await ChatService.recieveMessage({\n      from: currentUser._id,\n      to: currentChat._id\n    }).then(res => {\n      setMessages(res.data);\n    });\n  };\n\n  useEffect(() => {\n    getValue();\n  }, [currentChat]);\n\n  const handleSendMsg = async msg => {\n    await ChatService.sendMessage({\n      from: currentUser._id,\n      to: currentChat._id,\n      content: msg\n    });\n    const msgs = [...messages];\n    msgs.push({\n      fromSelf: true,\n      chat: msg\n    });\n    setMessages(msgs);\n    socket.current.emit(\"send-msg\", {\n      to: currentChat._id,\n      from: currentUser._id,\n      content: msg\n    });\n  };\n\n  useEffect(() => {\n    if (socket.current) {\n      socket.current.on(\"msg-recieve\", msg => {\n        setArrivalMessage({\n          fromSelf: false,\n          content: msg\n        });\n      });\n    }\n  }, [socket]);\n  useEffect(() => {\n    arrivalMessage && setMessages(prev => [...prev, arrivalMessage]);\n  }, [arrivalMessage]);\n  useEffect(() => {\n    var _scrollRef$current;\n\n    (_scrollRef$current = scrollRef.current) === null || _scrollRef$current === void 0 ? void 0 : _scrollRef$current.scrollIntoView({\n      behavior: \"smooth\"\n    });\n  }, [messages]);\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"chat\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"chat-header clearfix\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"row\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"col-lg-6\",\n            children: [/*#__PURE__*/_jsxDEV(\"a\", {\n              href: \"\",\n              \"data-toggle\": \"modal\",\n              \"data-target\": \"#view_info\",\n              children: /*#__PURE__*/_jsxDEV(\"img\", {\n                src: \"https://bootdey.com/img/Content/avatar/avatar2.png\",\n                alt: \"avatar\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 75,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 74,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"chat-about\",\n              children: [/*#__PURE__*/_jsxDEV(\"h6\", {\n                className: \"m-b-0\",\n                children: currentChat.fullName\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 78,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"small\", {\n                children: \"Last seen: 2 hours ago\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 79,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 77,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 73,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 72,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 71,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"chat-history\",\n        style: {\n          height: \"500px\"\n        },\n        children: messages.map(item => /*#__PURE__*/_jsxDEV(\"div\", {\n          ref: scrollRef,\n          children: /*#__PURE__*/_jsxDEV(\"ul\", {\n            className: \"m-b-0\",\n            children: /*#__PURE__*/_jsxDEV(\"li\", {\n              className: \"clearfix\",\n              children: /*#__PURE__*/_jsxDEV(\"div\", {\n                className: `message other-message ${item.fromSelf ? \"float-right\" : \"\"}`,\n                children: item.chat\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 94,\n                columnNumber: 23\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 89,\n              columnNumber: 21\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 88,\n            columnNumber: 19\n          }, this)\n        }, uuidv4(), false, {\n          fileName: _jsxFileName,\n          lineNumber: 87,\n          columnNumber: 17\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 84,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(ChatInput, {\n        handleSendMsg: handleSendMsg\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 103,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 70,\n      columnNumber: 7\n    }, this)\n  }, void 0, false);\n}\n\n_s(ChatContainer, \"GdK3c6f9nBpPtdlCKWfLC6gbCEk=\");\n\n_c = ChatContainer;\n\nvar _c;\n\n$RefreshReg$(_c, \"ChatContainer\");","map":{"version":3,"names":["React","useEffect","useState","useRef","ChatInput","io","ChatService","v4","uuidv4","ChatContainer","currentChat","currentUser","socket","messages","setMessages","arrivalMessage","setArrivalMessage","scrollRef","current","emit","_id","getValue","recieveMessage","from","to","then","res","data","handleSendMsg","msg","sendMessage","content","msgs","push","fromSelf","chat","on","prev","scrollIntoView","behavior","fullName","height","map","item"],"sources":["C:/Users/Admin/Documents/GitHub/Project/Book-Social-Network/frontend/src/components/Chat/Pages/ChatContainer.jsx"],"sourcesContent":["import React, {useEffect, useState, useRef} from \"react\";\r\nimport ChatInput from \"./ChatInput\";\r\nimport { io } from \"socket.io-client\";\r\n\r\nimport ChatService from \"../Service/service\";\r\nimport { v4 as uuidv4 } from 'uuid';\r\n\r\nexport default function ChatContainer({ currentChat, currentUser, socket }){\r\n  const [messages, setMessages] = useState([]);\r\n  const [arrivalMessage, setArrivalMessage] = useState(null);\r\n  const scrollRef = useRef();\r\n\r\n  useEffect(() =>{\r\n    if (currentUser){\r\n      socket.current = io(\"http://localhost:4000\");\r\n      socket.current.emit(\"add-user\", currentUser._id);\r\n    }\r\n  },[currentUser])\r\n\r\n  const getValue = async ()=>{\r\n    await ChatService.recieveMessage({\r\n      from: currentUser._id,\r\n      to: currentChat._id,\r\n    })\r\n    .then((res)=>{\r\n      setMessages(res.data)\r\n    })\r\n  }\r\n\r\n  useEffect(()=>{\r\n    getValue()\r\n  },[currentChat])\r\n\r\n  const handleSendMsg = async (msg) =>{\r\n    await ChatService.sendMessage({\r\n      from: currentUser._id,\r\n      to: currentChat._id,\r\n      content: msg,\r\n    })\r\n\r\n    const msgs = [...messages];\r\n    msgs.push({ fromSelf: true, chat: msg });\r\n    setMessages(msgs);\r\n\r\n    socket.current.emit(\"send-msg\", {\r\n      to: currentChat._id,\r\n      from: currentUser._id,\r\n      content: msg,\r\n    });\r\n  }\r\n\r\n  useEffect(() =>{\r\n    if (socket.current){\r\n      socket.current.on(\"msg-recieve\", (msg)=>{\r\n        setArrivalMessage({ fromSelf: false, content: msg })\r\n      })\r\n    }\r\n  },[socket])\r\n\r\n  useEffect(() => {\r\n    arrivalMessage && setMessages((prev) => [...prev, arrivalMessage]);\r\n  }, [arrivalMessage]);\r\n\r\n  useEffect(() => {\r\n    scrollRef.current?.scrollIntoView({ behavior: \"smooth\" });\r\n  }, [messages]);\r\n\r\n  return(\r\n    <>\r\n      <div className=\"chat\">\r\n        <div className=\"chat-header clearfix\">\r\n          <div className=\"row\">\r\n            <div className=\"col-lg-6\">\r\n              <a href=\"\" data-toggle=\"modal\" data-target=\"#view_info\">\r\n                <img src=\"https://bootdey.com/img/Content/avatar/avatar2.png\" alt=\"avatar\" />\r\n              </a>\r\n              <div className=\"chat-about\">\r\n                <h6 className=\"m-b-0\">{currentChat.fullName}</h6>\r\n                <small>Last seen: 2 hours ago</small>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div className=\"chat-history\" style={{ height:\"500px\" }}>\r\n            {\r\n              messages.map((item)=>(\r\n                <div ref={scrollRef} key={uuidv4()}>\r\n                  <ul className=\"m-b-0\">\r\n                    <li className=\"clearfix\">\r\n                      {/*<div className=\"message-data text-right\">*/}\r\n                      {/*  <span className=\"message-data-time\">10:10 AM, Today</span>*/}\r\n                      {/*  <img src=\"https://bootdey.com/img/Content/avatar/avatar7.png\" alt=\"avatar\" />*/}\r\n                      {/*</div>*/}\r\n                      <div className={`message other-message ${item.fromSelf ? \"float-right\" : \"\"}`}>\r\n                        {item.chat}\r\n                      </div>\r\n                    </li>\r\n                  </ul>\r\n                </div>\r\n              ))\r\n            }\r\n        </div>\r\n        <ChatInput handleSendMsg={handleSendMsg} />\r\n\r\n      </div>\r\n    </>\r\n  )\r\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}